# üß© sbgen ‚Äî –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π sing-box –∏–∑ YAML-—à–∞–±–ª–æ–Ω–æ–≤

**–ê–≤—Ç–æ—Ä:** Ivan Tarasov  
**–ì–æ–¥:** 2025  
**–õ–∏—Ü–µ–Ω–∑–∏—è:** MIT  

---

## üìò –û–±—â–µ–µ –æ–ø–∏—Å–∞–Ω–∏–µ

`sbgen` ‚Äî —ç—Ç–æ —É—Ç–∏–ª–∏—Ç–∞ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ JSON-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π [sing-box](https://sing-box.sagernet.org/) –∏–∑ —à–∞–±–ª–æ–Ω–æ–≤ (`.tpl`) –∏ YAML-–ø—Ä–æ—Ñ–∏–ª–µ–π.

–û–Ω–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç:
- –æ–ø–∏—Å—ã–≤–∞—Ç—å –º–∞—Ä—à—Ä—É—Ç—ã, –ø—Ä–∞–≤–∏–ª–∞ –∏ —Å–ø–∏—Å–∫–∏ –¥–æ–º–µ–Ω–æ–≤ –≤ YAML;
- –ø–æ–¥–∫–ª—é—á–∞—Ç—å –≤–Ω–µ—à–Ω–∏–µ —Å–ø–∏—Å–∫–∏ –¥–æ–º–µ–Ω–æ–≤ (`includes`);
- –æ–±—ä–µ–¥–∏–Ω—è—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–æ—Ñ–∏–ª–µ–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, `russia.yml`, `china.yml`);
- —É–ø—Ä–∞–≤–ª—è—Ç—å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º–∏ –∏ fallback-–ª–æ–≥–∏–∫–æ–π –≤ —à–∞–±–ª–æ–Ω–µ;
- –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –∏—Ç–æ–≥–æ–≤–æ–≥–æ JSON.

---

## ‚öôÔ∏è –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```bash
sbgen <template.tpl> <config.yml> [more.yml...]
```

**–ü—Ä–∏–º–µ—Ä—ã:**
```bash
sbgen nekobox.tpl russia.yml > sing-box.json
sbgen server.tpl global.yml local.yml > config.json
```

–ï—Å–ª–∏ –æ–¥–∏–Ω –∏–∑ —É–∫–∞–∑–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç ‚Äî —É—Ç–∏–ª–∏—Ç–∞ –∑–∞–≤–µ—Ä—à–∏—Ç —Ä–∞–±–æ—Ç—É —Å –æ—à–∏–±–∫–æ–π.

---

## üß± –°—Ç—Ä—É–∫—Ç—É—Ä–∞ YAML

–ö–∞–∂–¥—ã–π YAML-—Ñ–∞–π–ª –æ–ø–∏—Å—ã–≤–∞–µ—Ç –æ–¥–∏–Ω –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ **–ø—Ä–æ—Ñ–∏–ª–µ–π** (–Ω–∞–ø—Ä–∏–º–µ—Ä, `russia`, `china`, `office`).

–ü—Ä–∏–º–µ—Ä:

```yaml
russia:
  base_dir: ./lists
  default_direct: true
  lists:
    - name: world
      out: [ proxy, proxy2 ]
      fallback: false
      patterns:
        - "google.com"
        - "youtube.com"
        - "linkedin.com"
      includes:
        - "world.list"
  direct:
    - "myserver.local"
    - includes: ["direct.list"]
  blocked:
    - includes: ["block.list"]
```

---

## üìÑ –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø—Ä–æ—Ñ–∏–ª—è

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----------|------|----------|
| `base_dir` | `string` | –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ. –ë–∞–∑–æ–≤–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã—Ö –ø—É—Ç–µ–π `includes`. |
| `default_direct` | `bool` | –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ (`direct` –∏–ª–∏ –ø–µ—Ä–≤—ã–π —Å–ø–∏—Å–æ–∫ `out`). |
| `lists` | `list<object>` | –ù–∞–±–æ—Ä –º–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä—É–µ–º—ã—Ö –≥—Ä—É–ø–ø –¥–æ–º–µ–Ω–æ–≤. |
| `direct` | `list<mixed>` | –î–æ–º–µ–Ω—ã, –Ω–∞–ø—Ä–∞–≤–ª—è–µ–º—ã–µ –Ω–∞–ø—Ä—è–º—É—é. |
| `blocked` | `list<mixed>` | –î–æ–º–µ–Ω—ã, –±–ª–æ–∫–∏—Ä—É–µ–º—ã–µ (`outbound = block`). |

---

### üî∏ –≠–ª–µ–º–µ–Ω—Ç—ã `lists`

–ö–∞–∂–¥—ã–π —ç–ª–µ–º–µ–Ω—Ç –º–æ–∂–µ—Ç –≤–∫–ª—é—á–∞—Ç—å:

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|------|----------|
| `name` | `string` | –ù–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –∏–º—è —Å–ø–∏—Å–∫–∞. |
| `out` | `string` –∏–ª–∏ `list<string>` | –û–¥–∏–Ω –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ `outbound`, –∫—É–¥–∞ –Ω–∞–ø—Ä–∞–≤–ª—è—Ç—å —Ç—Ä–∞—Ñ–∏–∫. |
| `patterns` | `list<string>` | –°–ø–∏—Å–æ–∫ —à–∞–±–ª–æ–Ω–æ–≤ –¥–æ–º–µ–Ω–æ–≤. |
| `includes` | `list<string>` | –ü—É—Ç–∏ –∫ –≤–Ω–µ—à–Ω–∏–º —Ñ–∞–π–ª–∞–º (–ø–æ –æ–¥–Ω–æ–º—É –¥–æ–º–µ–Ω—É –Ω–∞ —Å—Ç—Ä–æ–∫—É, `#` ‚Äî –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π). |
| `fallback` | `bool` | –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ñ–ª–∞–≥ (–≤ `sbgen` –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –Ω–æ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è). |

---

## üß© –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —à–∞–±–ª–æ–Ω—ã –¥–æ–º–µ–Ω–æ–≤

| –ü—Ä–∏–º–µ—Ä | –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è |
|--------|----------------|
| `example.com` | `domain_suffix` |
| `.example.com` | `domain_suffix` |
| `*.example.com` | —à–∞–±–ª–æ–Ω —Å –ø–æ–¥–¥–æ–º–µ–Ω–∞–º–∏ |
| `rutracker.*` | —Ä–µ–≥—É–ª—è—Ä–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ (–ª—é–±–∞—è TLD) |
| `cdn.*.example.com` | —Ä–µ–≥—É–ª—è—Ä–∫–∞ |
| `*cdn.com` | —Ä–µ–≥—É–ª—è—Ä–∫–∞ |
| `localhost` | –æ–¥–∏–Ω–æ—á–Ω–∞—è –º–µ—Ç–∫–∞ |

---

## üìÇ –§–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–æ–≤ `includes`

–ü—Ä–∏–º–µ—Ä `world.list`:

```text
# streaming
youtube.com
netflix.com
*.hulu.com

# social
twitter.com
facebook.com
```

- –ö–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ ‚Äî –¥–æ–º–µ–Ω –∏–ª–∏ —à–∞–±–ª–æ–Ω.  
- `#` ‚Äî –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π.  
- –ü—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏ –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è.

---

## üß† –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã sbgen

1. –ó–∞–≥—Ä—É–∂–∞–µ—Ç `.tpl` —à–∞–±–ª–æ–Ω –∏ –≤—Å–µ YAML-—Ñ–∞–π–ª—ã.  
2. –û–±—ä–µ–¥–∏–Ω—è–µ—Ç –≤—Å–µ –≤–µ—Ä—Ö–Ω–µ—É—Ä–æ–≤–Ω–µ–≤—ã–µ –∫–ª—é—á–∏ (`tid`), –Ω–∞–ø—Ä–∏–º–µ—Ä, `russia`, `china`.  
3. –ò—â–µ—Ç –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã –≤–∏–¥–∞ `%%russia:in-tun%%`.  
4. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä–∞.  
5. –ü–æ–¥—Å—Ç–∞–≤–ª—è–µ—Ç –≥–æ—Ç–æ–≤—ã–µ JSON-—Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã.  
6. –í—ã—á–∏—Å–ª—è–µ—Ç `%%FINAL%%`, –µ—Å–ª–∏ –∑–∞–¥–∞–Ω.  
7. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∏—Ç–æ–≥ –Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å JSON.  

---

## üß© –ü—Ä–∏–º–µ—Ä 1 ‚Äî Standalone —Å–µ—Ä–≤–µ—Ä

**–®–∞–±–ª–æ–Ω (`server.tpl`):**
```json
{
  "route": {
    "rules": [
      %%russia:in-tun%%
    ],
    "final": "%%FINAL%%"
  }
}
```

**YAML (`russia.yml`):**
```yaml
russia:
  lists:
    - out: proxy
      patterns: [ "youtube.com", "twitter.com" ]
  direct: [ "intranet.local" ]
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```json
{
  "route": {
    "rules": [
      { "inbound": "in-tun", "outbound": "proxy", "domain_suffix": ["twitter.com", "youtube.com"] },
      { "inbound": "in-tun", "outbound": "direct", "domain_suffix": ["intranet.local"] }
    ],
    "final": "direct"
  }
}
```

---

## üåê –ü—Ä–∏–º–µ—Ä 2 ‚Äî NekoBox (—Ä–µ–∂–∏–º TUN)

**–®–∞–±–ª–æ–Ω (`nekobox.tpl`):**
```json
{
  "inbounds": [
    {
      "tag": "in-tun",
      "type": "tun",
      "endpoint_independent_nat": true,
      "inet4_address": ["172.19.0.1/28"],
      "mtu": 9000,
      "sniff": true,
      "stack": "mixed"
    }
  ],
  "route": {
    "rules": [ %%russia:in-tun%% ],
    "final": "%%FINAL%%"
  }
}
```

---

## üåç –ü—Ä–∏–º–µ—Ä 3 ‚Äî –ù–µ—Å–∫–æ–ª—å–∫–æ YAML –ø—Ä–æ—Ñ–∏–ª–µ–π

```bash
sbgen global.tpl russia.yml israel.yml > sing-box.json
```

- –ü–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã `%%russia:in-tun%%` –∏ `%%israel:in-tun%%` –±—É–¥—É—Ç –æ–±—ä–µ–¥–∏–Ω–µ–Ω—ã.  
- YAML-—Ñ–∞–π–ª—ã –æ–±—ä–µ–¥–∏–Ω—è—é—Ç—Å—è –ø–æ –∫–ª—é—á–∞–º `tid`.

---

## üß© –û—Ç–ª–∞–¥–∫–∞

–î–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è –æ—Ç–ª–∞–¥–æ—á–Ω–æ–≥–æ –≤—ã–≤–æ–¥–∞:
```bash
DEBUG=1 sbgen template.tpl config.yml
```

–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∑–∞–≥—Ä—É–∑–∫—É —Ñ–∞–π–ª–æ–≤, –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª–µ–π, –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã –∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞.

---

## ‚ö†Ô∏è –¢–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏

| –û—à–∏–±–∫–∞ | –ü—Ä–∏—á–∏–Ω–∞ |
|--------|----------|
| `Usage: sbgen <template> <yaml>` | –ù–µ –ø–µ—Ä–µ–¥–∞–Ω—ã –∞—Ä–≥—É–º–µ–Ω—Ç—ã |
| `File not found:` | –û–¥–∏–Ω –∏–∑ —Ñ–∞–π–ª–æ–≤ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç |
| `JSON error at line ...` | –û—à–∏–±–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ –≤ —à–∞–±–ª–æ–Ω–µ (–∑–∞–ø—è—Ç–∞—è –∏–ª–∏ –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä) |

---

## üìú –õ–∏—Ü–µ–Ω–∑–∏—è

MIT ¬© Ivan Tarasov, 2025  
–°–≤–æ–±–æ–¥–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ, –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –∞–≤—Ç–æ—Ä–∞.